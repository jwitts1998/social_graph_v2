<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Quality Validation Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        h1 {
            color: #2563eb;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 6px;
            border-left: 4px solid #2563eb;
        }
        
        .test-case {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .test-case h3 {
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .status.pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status.pass {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status.fail {
            background: #fee2e2;
            color: #991b1b;
        }
        
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #1d4ed8;
        }
        
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .results {
            margin-top: 15px;
            padding: 15px;
            background: #f3f4f6;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .progress {
            margin: 20px 0;
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: #2563eb;
            transition: width 0.3s;
        }
        
        .checklist {
            list-style: none;
        }
        
        .checklist li {
            padding: 8px 0;
            display: flex;
            align-items: center;
        }
        
        .checklist li::before {
            content: '‚ñ°';
            margin-right: 10px;
            font-size: 18px;
            color: #9ca3af;
        }
        
        .checklist li.checked::before {
            content: '‚úì';
            color: #10b981;
        }
        
        .instructions {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .instructions h4 {
            color: #1e40af;
            margin-bottom: 10px;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin: 5px 0;
        }
        
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }
        
        .summary-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #2563eb;
        }
        
        .summary-card .label {
            color: #6b7280;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Match Quality Validation Tool</h1>
        <p class="subtitle">Validate your matching algorithm with automated tests</p>
        
        <div class="instructions">
            <h4>üìã Before You Start:</h4>
            <ol>
                <li>Ensure test data has been created (run <code>TEST_DATASET.sql</code>)</li>
                <li>Make sure you're logged in to the application</li>
                <li>Open browser DevTools (F12) to see detailed logs</li>
            </ol>
        </div>
        
        <div class="section">
            <h2>Validation Tests</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">
                This tool will check 5 test conversations against expected results.
                Each test validates different aspects of the matching algorithm.
            </p>
            
            <div class="test-case">
                <h3>Test 1: Biotech Fundraising ‚Üí Sarah Chen (3‚≠ê)</h3>
                <span class="status pending" id="status-1">PENDING</span>
                <p style="margin: 10px 0; color: #6b7280;">
                    Tests: Sector matching, stage filtering, tag overlap, embedding similarity
                </p>
                <button onclick="runTest(1)" id="btn-1">Run Test</button>
                <div class="results" id="results-1" style="display: none;"></div>
            </div>
            
            <div class="test-case">
                <h3>Test 2: CTO Hiring ‚Üí Alex Kumar (3‚≠ê)</h3>
                <span class="status pending" id="status-2">PENDING</span>
                <p style="margin: 10px 0; color: #6b7280;">
                    Tests: Role matching, skill alignment, context awareness
                </p>
                <button onclick="runTest(2)" id="btn-2">Run Test</button>
                <div class="results" id="results-2" style="display: none;"></div>
            </div>
            
            <div class="test-case">
                <h3>Test 3: Name Matching ‚Üí Robert Smith (3‚≠ê)</h3>
                <span class="status pending" id="status-3">PENDING</span>
                <p style="margin: 10px 0; color: #6b7280;">
                    Tests: Fuzzy name matching (Bob ‚Üî Robert), name boost, nickname dictionary
                </p>
                <button onclick="runTest(3)" id="btn-3">Run Test</button>
                <div class="results" id="results-3" style="display: none;"></div>
            </div>
            
            <div class="test-case">
                <h3>Test 4: SaaS Strategy ‚Üí Michael Rodriguez (2-3‚≠ê)</h3>
                <span class="status pending" id="status-4">PENDING</span>
                <p style="margin: 10px 0; color: #6b7280;">
                    Tests: Multi-factor scoring, Series A alignment, multiple matches
                </p>
                <button onclick="runTest(4)" id="btn-4">Run Test</button>
                <div class="results" id="results-4" style="display: none;"></div>
            </div>
            
            <div class="test-case">
                <h3>Test 5: Office Logistics ‚Üí No Matches (0‚≠ê)</h3>
                <span class="status pending" id="status-5">PENDING</span>
                <p style="margin: 10px 0; color: #6b7280;">
                    Tests: False positive prevention, threshold enforcement
                </p>
                <button onclick="runTest(5)" id="btn-5">Run Test</button>
                <div class="results" id="results-5" style="display: none;"></div>
            </div>
        </div>
        
        <div class="section">
            <h2>Quick Actions</h2>
            <button onclick="runAllTests()" style="margin-right: 10px;">Run All Tests</button>
            <button onclick="exportResults()">Export Results</button>
            
            <div class="progress" style="margin-top: 20px;">
                <div class="progress-bar" id="progress" style="width: 0%"></div>
            </div>
            
            <div class="summary" id="summary" style="display: none;">
                <div class="summary-card">
                    <div class="value" id="total-tests">0</div>
                    <div class="label">Total Tests</div>
                </div>
                <div class="summary-card">
                    <div class="value" id="passed-tests" style="color: #10b981;">0</div>
                    <div class="label">Passed</div>
                </div>
                <div class="summary-card">
                    <div class="value" id="failed-tests" style="color: #ef4444;">0</div>
                    <div class="label">Failed</div>
                </div>
                <div class="summary-card">
                    <div class="value" id="pass-rate">0%</div>
                    <div class="label">Pass Rate</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // NOTE: This is a UI mockup. The actual implementation would need to:
        // 1. Connect to your Supabase instance
        // 2. Query conversations and match_suggestions tables
        // 3. Validate results against expected values
        
        const testCases = {
            1: {
                title: 'Biotech Seed Round Discussion',
                expectedContact: 'Sarah Chen',
                expectedStars: 3,
            },
            2: {
                title: 'CTO Search Discussion',
                expectedContact: 'Alex Kumar',
                expectedStars: 3,
            },
            3: {
                title: 'Fintech Investor Introduction',
                expectedContact: 'Robert Smith',
                expectedStars: 3,
            },
            4: {
                title: 'Enterprise SaaS Product Strategy',
                expectedContact: 'Michael Rodriguez',
                expectedStars: 2, // or 3
            },
            5: {
                title: 'Office Logistics Discussion',
                expectedContact: 'None',
                expectedStars: 0,
            },
        };
        
        let results = {};
        
        async function runTest(testId) {
            const btn = document.getElementById(`btn-${testId}`);
            const status = document.getElementById(`status-${testId}`);
            const resultsDiv = document.getElementById(`results-${testId}`);
            
            btn.disabled = true;
            btn.textContent = 'Running...';
            status.className = 'status pending';
            status.textContent = 'RUNNING';
            resultsDiv.style.display = 'block';
            resultsDiv.textContent = 'Fetching data from database...\\n';
            
            // Simulate test execution
            setTimeout(() => {
                const testCase = testCases[testId];
                let testOutput = `Test: ${testCase.title}\\n`;
                testOutput += `Expected: ${testCase.expectedContact} (${testCase.expectedStars}‚≠ê)\\n`;
                testOutput += `\\n`;
                
                // This is where you'd actually query the database
                // For now, show instructions
                testOutput += '‚ö†Ô∏è MANUAL VALIDATION REQUIRED\\n';
                testOutput += '\\n';
                testOutput += 'Please manually check:\\n';
                testOutput += `1. Navigate to "${testCase.title}" conversation\\n`;
                testOutput += `2. Check if top match is "${testCase.expectedContact}"\\n`;
                testOutput += `3. Verify star rating is ${testCase.expectedStars}‚≠ê\\n`;
                testOutput += `4. Click "View Details" to check score breakdown\\n`;
                testOutput += `5. Update this tool's result below\\n`;
                
                resultsDiv.textContent = testOutput;
                
                // Add manual pass/fail buttons
                const passBtn = document.createElement('button');
                passBtn.textContent = '‚úì Pass';
                passBtn.style.background = '#10b981';
                passBtn.style.marginRight = '10px';
                passBtn.onclick = () => updateTestResult(testId, true);
                
                const failBtn = document.createElement('button');
                failBtn.textContent = '‚úó Fail';
                failBtn.style.background = '#ef4444';
                failBtn.onclick = () => updateTestResult(testId, false);
                
                resultsDiv.appendChild(document.createElement('br'));
                resultsDiv.appendChild(passBtn);
                resultsDiv.appendChild(failBtn);
                
                btn.disabled = false;
                btn.textContent = 'Re-run Test';
            }, 1000);
        }
        
        function updateTestResult(testId, passed) {
            const status = document.getElementById(`status-${testId}`);
            
            results[testId] = passed;
            
            if (passed) {
                status.className = 'status pass';
                status.textContent = 'PASS ‚úì';
            } else {
                status.className = 'status fail';
                status.textContent = 'FAIL ‚úó';
            }
            
            updateSummary();
        }
        
        function updateSummary() {
            const totalTests = Object.keys(results).length;
            const passedTests = Object.values(results).filter(r => r).length;
            const failedTests = totalTests - passedTests;
            const passRate = totalTests > 0 ? Math.round((passedTests / 5) * 100) : 0;
            
            document.getElementById('total-tests').textContent = totalTests;
            document.getElementById('passed-tests').textContent = passedTests;
            document.getElementById('failed-tests').textContent = failedTests;
            document.getElementById('pass-rate').textContent = passRate + '%';
            document.getElementById('summary').style.display = 'grid';
            
            const progress = (totalTests / 5) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }
        
        async function runAllTests() {
            for (let i = 1; i <= 5; i++) {
                await runTest(i);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }
        
        function exportResults() {
            const totalTests = Object.keys(results).length;
            const passedTests = Object.values(results).filter(r => r).length;
            const passRate = totalTests > 0 ? Math.round((passedTests / 5) * 100) : 0;
            
            let report = '# Match Validation Results\\n\\n';
            report += `**Date**: ${new Date().toISOString().split('T')[0]}\\n`;
            report += `**Pass Rate**: ${passedTests}/5 (${passRate}%)\\n\\n`;
            report += '## Test Results\\n\\n';
            report += '| Test | Expected | Status |\\n';
            report += '|------|----------|--------|\\n';
            
            Object.keys(testCases).forEach(id => {
                const test = testCases[id];
                const result = results[id];
                const status = result === true ? '‚úÖ PASS' : result === false ? '‚ùå FAIL' : '‚è≥ PENDING';
                report += `| ${test.title} | ${test.expectedContact} (${test.expectedStars}‚≠ê) | ${status} |\\n`;
            });
            
            // Download as markdown file
            const blob = new Blob([report], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'match_validation_results.md';
            a.click();
        }
    </script>
</body>
</html>
